<?php

namespace App\Http\Controllers;

use Illuminate\Support\Facades\DB;
use App\Models\Routen;
use App\Models\Routenpunkte;
use App\Models\Fahrzeuge;
use Illuminate\Http\Request;


class SzenarioController extends Controller
{
public function getAlleRouten() //Erster Teil Szenario
{
   $positionen = [
    // Wartungsbereich
    "WB-1" => ['x' => 95, 'y' => 409], "WB-2" => ['x' => 95, 'y' => 364], "WB-3" => ['x' => 95, 'y' => 319], "WB-4" => ['x' => 95, 'y' => 274], 
    "WB-5" => ['x' => 95, 'y' => 229], "WB-6" => ['x' => 95, 'y' => 184], "WB-7" => ['x' => 95, 'y' => 139], "WB-8" => ['x' => 95, 'y' => 94],

    // HR-Reihe 1–7 
    "HR-1-1" => ['x' => 660, 'y' => 409], "HR-1-2" => ['x' => 660, 'y' => 364], "HR-1-3" => ['x' => 660, 'y' => 319], "HR-1-4" => ['x' => 660, 'y' => 274], 
    "HR-1-5" => ['x' => 660, 'y' => 229], "HR-1-6" => ['x' => 660, 'y' => 184], "HR-1-7" => ['x' => 660, 'y' => 139], "HR-1-8" => ['x' => 660, 'y' => 94],
    "HR-2-1" => ['x' => 620, 'y' => 409], "HR-2-2" => ['x' => 620, 'y' => 364], "HR-2-3" => ['x' => 620, 'y' => 319], "HR-2-4" => ['x' => 620, 'y' => 274], 
    "HR-2-5" => ['x' => 620, 'y' => 229], "HR-2-6" => ['x' => 620, 'y' => 184], "HR-2-7" => ['x' => 620, 'y' => 139], "HR-2-8" => ['x' => 620, 'y' => 94],
    "HR-3-1" => ['x' => 518, 'y' => 409], "HR-3-2" => ['x' => 518, 'y' => 364], "HR-3-3" => ['x' => 518, 'y' => 319], "HR-3-4" => ['x' => 518, 'y' => 274], 
    "HR-3-5" => ['x' => 518, 'y' => 229], "HR-3-6" => ['x' => 518, 'y' => 184], "HR-3-7" => ['x' => 518, 'y' => 139], "HR-3-8" => ['x' => 518, 'y' => 94],
    "HR-4-1" => ['x' => 478, 'y' => 409], "HR-4-2" => ['x' => 478, 'y' => 364], "HR-4-3" => ['x' => 478, 'y' => 319], "HR-4-4" => ['x' => 478, 'y' => 274], 
    "HR-4-5" => ['x' => 478, 'y' => 229], "HR-4-6" => ['x' => 478, 'y' => 184], "HR-4-7" => ['x' => 478, 'y' => 139], "HR-4-8" => ['x' => 478, 'y' => 94],
    "HR-5-1" => ['x' => 371, 'y' => 409], "HR-5-2" => ['x' => 371, 'y' => 364], "HR-5-3" => ['x' => 371, 'y' => 319], "HR-5-4" => ['x' => 371, 'y' => 274], 
    "HR-5-5" => ['x' => 371, 'y' => 229], "HR-5-6" => ['x' => 371, 'y' => 184], "HR-5-7" => ['x' => 371, 'y' => 139], "HR-5-8" => ['x' => 371, 'y' => 94],
    "HR-6-1" => ['x' => 331, 'y' => 409], "HR-6-2" => ['x' => 331, 'y' => 364], "HR-6-3" => ['x' => 331, 'y' => 319], "HR-6-4" => ['x' => 331, 'y' => 274], 
    "HR-6-5" => ['x' => 331, 'y' => 229], "HR-6-6" => ['x' => 331, 'y' => 184], "HR-6-7" => ['x' => 331, 'y' => 139], "HR-6-8" => ['x' => 331, 'y' => 94],
    "HR-7-1" => ['x' => 225, 'y' => 409], "HR-7-2" => ['x' => 225, 'y' => 364], "HR-7-3" => ['x' => 225, 'y' => 319], "HR-7-4" => ['x' => 225, 'y' => 274], 
    "HR-7-5" => ['x' => 225, 'y' => 229], "HR-7-6" => ['x' => 225, 'y' => 184], "HR-7-7" => ['x' => 225, 'y' => 139], "HR-7-8" => ['x' => 225, 'y' => 94],

    // Wartbereich Gange WBG
    "WBG-1" => ['x' => 189, 'y' => 409], "WBG-2" => ['x' => 189, 'y' => 364], "WBG-3" => ['x' => 189, 'y' => 319], "WBG-4" => ['x' => 189, 'y' => 274], 
    "WBG-5" => ['x' => 189, 'y' => 229], "WBG-6" => ['x' => 189, 'y' => 184], "WBG-7" => ['x' => 189, 'y' => 139], "WBG-8" => ['x' => 189, 'y' => 94],

    // GA 
    "GA-1" => ['x' => 660, 'y' => 500], "GA-2" => ['x' => 620, 'y' => 500], "GA-3" => ['x' => 518, 'y' => 500], "GA-4" => ['x' => 478, 'y' => 500], 
    "GA-5" => ['x' => 371, 'y' => 500], "GA-6" => ['x' => 331, 'y' => 500], "GA-7" => ['x' => 225, 'y' => 500], "GA-L-UNTEN" => ['x' => 95, 'y' => 500], 
    "GA-R-OBEN" => ['x' => 660, 'y' => 785], "GA-R-MITTE-U" => ['x' => 345, 'y' => 785], "GA-R-UNTEN" => ['x' => 95, 'y' => 785], "GA-R-MITTE-O" => ['x' => 405, 'y' => 785],

    // BP Links 
    "BP-1-L" => ['x' => 560.5, 'y' => 565], "BP-3-L" => ['x' => 488.5, 'y' => 565], "BP-5-L" => ['x' => 261.5, 'y' => 565], "BP-7-L" => ['x' => 189.5, 'y' => 565],

    // BP GAL 
    "BP-1-GA-L" => ['x' => 560.5, 'y' => 500], "BP-3-GA-L" => ['x' => 488.5, 'y' => 500], "BP-5-GA-L" => ['x' => 261.5, 'y' => 500], "BP-7-GA-L" => ['x' => 189.5, 'y' => 500],

    // BP Rechts 
    "BP-2-R" => ['x' => 560.5, 'y' => 725], "BP-4-R" => ['x' => 488.5, 'y' => 725], "BP-6-R" => ['x' => 261.5, 'y' => 725], "BP-8-R" => ['x' => 189.5, 'y' => 725],

    // BP GAR 
    "BP-2-GA-R" => ['x' => 560.5, 'y' => 785], "BP-4-GA-R" => ['x' => 488.5, 'y' => 785], "BP-6-GA-R" => ['x' => 261.5, 'y' => 785], "BP-8-GA-R" => ['x' => 189.5, 'y' => 785],

    // BP Oben / Unten
    "BP-1-O" => ['x' => 596, 'y' => 605], "BP-2-O" => ['x' => 596, 'y' => 687], "BP-7-U" => ['x' => 155, 'y' => 605], "BP-8-U" => ['x' => 155, 'y' => 687],

    // BP Oben / Unten 
    "BP-1-O-GA-L" => ['x' => 596, 'y' => 500], "BP-1-O-GA-O" => ['x' => 660, 'y' => 605], "BP-2-O-GA-R" => ['x' => 596, 'y' => 785], "BP-2-O-GA-O" => ['x' => 660, 'y' => 687],
    "BP-7-U-GA-L" => ['x' => 155, 'y' => 500], "BP-7-U-GA-U" => ['x' => 95, 'y' => 605], "BP-8-U-GA-R" => ['x' => 155, 'y' => 785], "BP-8-U-GA-U" => ['x' => 95, 'y' => 687],

    // Zugänge zu Warenein-/-ausgang
    "WA-1" => ['x' => 345, 'y' => 880], "WA-2" => ['x' => 345, 'y' => 1010], "WA-3" => ['x' => 345, 'y' => 1057], "WA-4" => ['x' => 345, 'y' => 1180],
    "WE-1" => ['x' => 405, 'y' => 880], "WE-2" => ['x' => 405, 'y' => 1010], "WE-3" => ['x' => 405, 'y' => 1057], "WE-4" => ['x' => 405, 'y' => 1180],

    // WA-Reihen
    "WA-1-1" => ['x' => 305, 'y' => 880], "WA-1-2" => ['x' => 260, 'y' => 880], "WA-1-3" => ['x' => 215, 'y' => 880], "WA-1-4" => ['x' => 170, 'y' => 880],
    "WA-2-1" => ['x' => 305, 'y' => 1010], "WA-2-2" => ['x' => 260, 'y' => 1010], "WA-2-3" => ['x' => 215, 'y' => 1010], "WA-2-4" => ['x' => 170, 'y' => 1010],
    "WA-3-1" => ['x' => 305, 'y' => 1057], "WA-3-2" => ['x' => 260, 'y' => 1057], "WA-3-3" => ['x' => 215, 'y' => 1057], "WA-3-4" => ['x' => 170, 'y' => 1057],
    "WA-4-1" => ['x' => 305, 'y' => 1180], "WA-4-2" => ['x' => 260, 'y' => 1180], "WA-4-3" => ['x' => 215, 'y' => 1180], "WA-4-4" => ['x' => 170, 'y' => 1180],

    // WE-Reihen 
    "WE-1-1" => ['x' => 450, 'y' => 880], "WE-1-2" => ['x' => 495, 'y' => 880], "WE-1-3" => ['x' => 540, 'y' => 880], "WE-1-4" => ['x' => 585, 'y' => 880],
    "WE-2-1" => ['x' => 450, 'y' => 1010], "WE-2-2" => ['x' => 495, 'y' => 1010], "WE-2-3" => ['x' => 540, 'y' => 1010], "WE-2-4" => ['x' => 585, 'y' => 1010],
    "WE-3-1" => ['x' => 450, 'y' => 1057], "WE-3-2" => ['x' => 495, 'y' => 1057], "WE-3-3" => ['x' => 540, 'y' => 1057], "WE-3-4" => ['x' => 585, 'y' => 1057],
    "WE-4-1" => ['x' => 450, 'y' => 1180], "WE-4-2" => ['x' => 495, 'y' => 1180], "WE-4-3" => ['x' => 540, 'y' => 1180], "WE-4-4" => ['x' => 585, 'y' => 1180],
];

    // Routen werden geladen
    $routen = Routen::with([
        'routenpunkte' => function ($query) {
            $query->orderBy('pivot_reihenfolge');
        },
        'fahrzeug',
        'startort',
        'zielort'
    ])->get();

    $routenMitKoordinaten = $routen->map(function ($route) {
        $punkte = $route->routenpunkte->map(function ($punkt) {
            return [
                'punktname' => $punkt->routenpunkte_id,
                'x' => $punkt->x,
                'y' => $punkt->y,
            ];
        });

        return [
            'route_id' => $route->id,
            'fahrzeug_id' => $route->fahrzeug_id,
            'startort' => $route->startort?->lagerplatz_id,
            'zielort' => $route->zielort?->lagerplatz_id,
            'punkte' => $punkte,
        ];
    });

    return response()->json($routenMitKoordinaten);
}
    public function getAlleRoutenzwei() //zweiter Teil Szenario
{
   $positionen = [
    // WB
    "WB-1" => ['x' => 95, 'y' => 409], "WB-2" => ['x' => 95, 'y' => 364], "WB-3" => ['x' => 95, 'y' => 319], "WB-4" => ['x' => 95, 'y' => 274], 
    "WB-5" => ['x' => 95, 'y' => 229], "WB-6" => ['x' => 95, 'y' => 184], "WB-7" => ['x' => 95, 'y' => 139], "WB-8" => ['x' => 95, 'y' => 94],

    // HR-Reihe 1–7
    "HR-1-1" => ['x' => 660, 'y' => 409], "HR-1-2" => ['x' => 660, 'y' => 364], "HR-1-3" => ['x' => 660, 'y' => 319], "HR-1-4" => ['x' => 660, 'y' => 274], 
    "HR-1-5" => ['x' => 660, 'y' => 229], "HR-1-6" => ['x' => 660, 'y' => 184], "HR-1-7" => ['x' => 660, 'y' => 139], "HR-1-8" => ['x' => 660, 'y' => 94],
    "HR-2-1" => ['x' => 620, 'y' => 409], "HR-2-2" => ['x' => 620, 'y' => 364], "HR-2-3" => ['x' => 620, 'y' => 319], "HR-2-4" => ['x' => 620, 'y' => 274], 
    "HR-2-5" => ['x' => 620, 'y' => 229], "HR-2-6" => ['x' => 620, 'y' => 184], "HR-2-7" => ['x' => 620, 'y' => 139], "HR-2-8" => ['x' => 620, 'y' => 94],
    "HR-3-1" => ['x' => 518, 'y' => 409], "HR-3-2" => ['x' => 518, 'y' => 364], "HR-3-3" => ['x' => 518, 'y' => 319], "HR-3-4" => ['x' => 518, 'y' => 274], 
    "HR-3-5" => ['x' => 518, 'y' => 229], "HR-3-6" => ['x' => 518, 'y' => 184], "HR-3-7" => ['x' => 518, 'y' => 139], "HR-3-8" => ['x' => 518, 'y' => 94],
    "HR-4-1" => ['x' => 478, 'y' => 409], "HR-4-2" => ['x' => 478, 'y' => 364], "HR-4-3" => ['x' => 478, 'y' => 319], "HR-4-4" => ['x' => 478, 'y' => 274], 
    "HR-4-5" => ['x' => 478, 'y' => 229], "HR-4-6" => ['x' => 478, 'y' => 184], "HR-4-7" => ['x' => 478, 'y' => 139], "HR-4-8" => ['x' => 478, 'y' => 94],
    "HR-5-1" => ['x' => 371, 'y' => 409], "HR-5-2" => ['x' => 371, 'y' => 364], "HR-5-3" => ['x' => 371, 'y' => 319], "HR-5-4" => ['x' => 371, 'y' => 274], 
    "HR-5-5" => ['x' => 371, 'y' => 229], "HR-5-6" => ['x' => 371, 'y' => 184], "HR-5-7" => ['x' => 371, 'y' => 139], "HR-5-8" => ['x' => 371, 'y' => 94],
    "HR-6-1" => ['x' => 331, 'y' => 409], "HR-6-2" => ['x' => 331, 'y' => 364], "HR-6-3" => ['x' => 331, 'y' => 319], "HR-6-4" => ['x' => 331, 'y' => 274], 
    "HR-6-5" => ['x' => 331, 'y' => 229], "HR-6-6" => ['x' => 331, 'y' => 184], "HR-6-7" => ['x' => 331, 'y' => 139], "HR-6-8" => ['x' => 331, 'y' => 94],
    "HR-7-1" => ['x' => 225, 'y' => 409], "HR-7-2" => ['x' => 225, 'y' => 364], "HR-7-3" => ['x' => 225, 'y' => 319], "HR-7-4" => ['x' => 225, 'y' => 274], 
    "HR-7-5" => ['x' => 225, 'y' => 229], "HR-7-6" => ['x' => 225, 'y' => 184], "HR-7-7" => ['x' => 225, 'y' => 139], "HR-7-8" => ['x' => 225, 'y' => 94],

    //WBG
    "WBG-1" => ['x' => 189, 'y' => 409], "WBG-2" => ['x' => 189, 'y' => 364], "WBG-3" => ['x' => 189, 'y' => 319], "WBG-4" => ['x' => 189, 'y' => 274], 
    "WBG-5" => ['x' => 189, 'y' => 229], "WBG-6" => ['x' => 189, 'y' => 184], "WBG-7" => ['x' => 189, 'y' => 139], "WBG-8" => ['x' => 189, 'y' => 94],

    // GA
    "GA-1" => ['x' => 660, 'y' => 500], "GA-2" => ['x' => 620, 'y' => 500], "GA-3" => ['x' => 518, 'y' => 500], "GA-4" => ['x' => 478, 'y' => 500], 
    "GA-5" => ['x' => 371, 'y' => 500], "GA-6" => ['x' => 331, 'y' => 500], "GA-7" => ['x' => 225, 'y' => 500], "GA-L-UNTEN" => ['x' => 95, 'y' => 500], 
    "GA-R-OBEN" => ['x' => 660, 'y' => 785], "GA-R-MITTE-U" => ['x' => 345, 'y' => 785], "GA-R-UNTEN" => ['x' => 95, 'y' => 785], "GA-R-MITTE-O" => ['x' => 405, 'y' => 785],

    // BP Links 
    "BP-1-L" => ['x' => 560.5, 'y' => 565], "BP-3-L" => ['x' => 488.5, 'y' => 565], "BP-5-L" => ['x' => 261.5, 'y' => 565], "BP-7-L" => ['x' => 189.5, 'y' => 565],

    // BP GAL
    "BP-1-GA-L" => ['x' => 560.5, 'y' => 500], "BP-3-GA-L" => ['x' => 488.5, 'y' => 500], "BP-5-GA-L" => ['x' => 261.5, 'y' => 500], "BP-7-GA-L" => ['x' => 189.5, 'y' => 500],

    // BP Rechts
    "BP-2-R" => ['x' => 560.5, 'y' => 725], "BP-4-R" => ['x' => 488.5, 'y' => 725], "BP-6-R" => ['x' => 261.5, 'y' => 725], "BP-8-R" => ['x' => 189.5, 'y' => 725],

    // BP GAR
    "BP-2-GA-R" => ['x' => 560.5, 'y' => 785], "BP-4-GA-R" => ['x' => 488.5, 'y' => 785], "BP-6-GA-R" => ['x' => 261.5, 'y' => 785], "BP-8-GA-R" => ['x' => 189.5, 'y' => 785],

    // BP Oben / Unten
    "BP-1-O" => ['x' => 596, 'y' => 605], "BP-2-O" => ['x' => 596, 'y' => 687], "BP-7-U" => ['x' => 155, 'y' => 605], "BP-8-U" => ['x' => 155, 'y' => 687],

    // BP Oben / Unten 
    "BP-1-O-GA-L" => ['x' => 596, 'y' => 500], "BP-1-O-GA-O" => ['x' => 660, 'y' => 605], "BP-2-O-GA-R" => ['x' => 596, 'y' => 785], "BP-2-O-GA-O" => ['x' => 660, 'y' => 687],
    "BP-7-U-GA-L" => ['x' => 155, 'y' => 500], "BP-7-U-GA-U" => ['x' => 95, 'y' => 605], "BP-8-U-GA-R" => ['x' => 155, 'y' => 785], "BP-8-U-GA-U" => ['x' => 95, 'y' => 687],

    // Zugänge zu Warenein-/-ausgang
    "WA-1" => ['x' => 345, 'y' => 880], "WA-2" => ['x' => 345, 'y' => 1010], "WA-3" => ['x' => 345, 'y' => 1057], "WA-4" => ['x' => 345, 'y' => 1180],
    "WE-1" => ['x' => 405, 'y' => 880], "WE-2" => ['x' => 405, 'y' => 1010], "WE-3" => ['x' => 405, 'y' => 1057], "WE-4" => ['x' => 405, 'y' => 1180],

    // WA-Reihen 
    "WA-1-1" => ['x' => 305, 'y' => 880], "WA-1-2" => ['x' => 260, 'y' => 880], "WA-1-3" => ['x' => 215, 'y' => 880], "WA-1-4" => ['x' => 170, 'y' => 880],
    "WA-2-1" => ['x' => 305, 'y' => 1010], "WA-2-2" => ['x' => 260, 'y' => 1010], "WA-2-3" => ['x' => 215, 'y' => 1010], "WA-2-4" => ['x' => 170, 'y' => 1010],
    "WA-3-1" => ['x' => 305, 'y' => 1057], "WA-3-2" => ['x' => 260, 'y' => 1057], "WA-3-3" => ['x' => 215, 'y' => 1057], "WA-3-4" => ['x' => 170, 'y' => 1057],
    "WA-4-1" => ['x' => 305, 'y' => 1180], "WA-4-2" => ['x' => 260, 'y' => 1180], "WA-4-3" => ['x' => 215, 'y' => 1180], "WA-4-4" => ['x' => 170, 'y' => 1180],

    // WE-Reihen 
    "WE-1-1" => ['x' => 450, 'y' => 880], "WE-1-2" => ['x' => 495, 'y' => 880], "WE-1-3" => ['x' => 540, 'y' => 880], "WE-1-4" => ['x' => 585, 'y' => 880],
    "WE-2-1" => ['x' => 450, 'y' => 1010], "WE-2-2" => ['x' => 495, 'y' => 1010], "WE-2-3" => ['x' => 540, 'y' => 1010], "WE-2-4" => ['x' => 585, 'y' => 1010],
    "WE-3-1" => ['x' => 450, 'y' => 1057], "WE-3-2" => ['x' => 495, 'y' => 1057], "WE-3-3" => ['x' => 540, 'y' => 1057], "WE-3-4" => ['x' => 585, 'y' => 1057],
    "WE-4-1" => ['x' => 450, 'y' => 1180], "WE-4-2" => ['x' => 495, 'y' => 1180], "WE-4-3" => ['x' => 540, 'y' => 1180], "WE-4-4" => ['x' => 585, 'y' => 1180],
];

    // Routen werden geladen
    $routen = Routen::with([
        'routenpunkte' => function ($query) {
            $query->orderBy('pivot_reihenfolge');
        },
        'fahrzeug',
        'startort',
        'zielort'
    ])->get();

    $routenMitKoordinaten = $routen->map(function ($route) {
        $punkte = $route->routenpunkte->map(function ($punkt) {
            return [
                'punktname' => $punkt->routenpunkte_id,
                'x' => $punkt->x,
                'y' => $punkt->y,
            ];
        });

        return [
            'route_id' => $route->id,
            'fahrzeug_id' => $route->fahrzeug_id,
            'startort' => $route->startort?->lagerplatz_id,
            'zielort' => $route->zielort?->lagerplatz_id,
            'punkte' => $punkte,
        ];
    });

    return response()->json($routenMitKoordinaten);
}
public function updatePosition(Request $request) //Postion während des Szenarios updaten
{
    $request->validate([
        'fahrzeug_id' => 'required|string',
        'x' => 'required|numeric',
        'y' => 'required|numeric'
    ]);

    $fahrzeug = Fahrzeuge::where('fahrzeug_id', $request->fahrzeug_id)->first();
    if (!$fahrzeug) {
        return response()->json(['error' => 'Fahrzeug nicht gefunden'], 404);
    }

    $fahrzeug->x = $request->x;
    $fahrzeug->y = $request->y;
    $fahrzeug->save();

    return response()->json(['success' => true]);
}
}

